//- - - - - - - - - - - - -
// OASIS Feedback Tool  //
//- - - - - - - - - - - - -
// By Jon Jenkins, 2010 //
//- - - - - - - - - - - - -
var mkey = gup("mkey");
var mId = gup("mid");
var path = "unknown"; //Can't detect
var cachebust = escape((new Date).valueOf());
var selMKey;

function gup(name) {
    name = name.toUpperCase().replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regexS = "[\\?&]" + name + "=([^&#]*)";
    var regex = new RegExp(regexS);
    var results = regex.exec(window.location.href.toUpperCase());
    if (results == null)
        return "unknown";
    else
        return results[1];
}
if (mkey != "unknown") {
    mkey = mkey.replace(/%7B/gi, "{").replace(/%7D/gi, "}").replace(/%2D/gi, "-"); //Clean-up MKey for consistency
}
if (mId != "unknown") {
    mkey = mId; // to capture mid when mkey is not used (Session Builder)
}

pathArray = window.location.pathname.toUpperCase().split("/");
for (i = 0; i < pathArray.length; i++) {
    if (i == 1) { path = pathArray[i]; }
}

//For Admin - capture selected mKey from dropdown
selMKey = "";
if (path == "ADMIN") {
    selMKey = document.getElementById("selectMeetingKey");
    if (selMKey != null) {
        mkey = selMKey.value;
    }
}

document.write("<iframe id='oFeedback' width='66' height='23' src='/survey/iframe.html?path=" + path + "&mkey=" + mkey + "&cb=" + cachebust + "' frameborder='no' scrolling='no'></iframe>");